<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stockbee Market Monitor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            background-color: #f9fafb;
        }
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 400px;
            font-size: 18px;
            color: #666;
        }
        .chart-container {
            width: 100%;
            height: 400px;
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div id="root">
        <div class="loading">Loading Stockbee Market Monitor...</div>
    </div>

    <!-- Load Chart.js for reliable charting -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Simple approach - load Chart.js and create charts
        function loadCharts() {
            if (typeof Chart !== 'undefined') {
                initChartVersion();
            } else {
                initBasicVersion();
            }
        }
        
        function initChartVersion() {
            // Generate sample data
            function generateSampleData() {
                const data = [];
                const startDate = new Date('2024-01-01');
                
                for (let i = 0; i < 180; i++) {
                    const date = new Date(startDate.getTime() + i * 24 * 60 * 60 * 1000);
                    if (date.getDay() === 0 || date.getDay() === 6) continue;
                    
                    const trend = Math.sin(i / 50) * 50;
                    const volatility = Math.sin(i / 20) * 20;
                    const noise = (Math.random() - 0.5) * 40;
                    
                    data.push({
                        date: date.toLocaleDateString(),
                        stocks_up_4pct: Math.max(0, Math.round(120 + trend + volatility + noise)),
                        stocks_down_4pct: Math.max(0, Math.round(100 - trend + volatility + Math.abs(noise))),
                        t2108: Math.max(10, Math.min(90, Math.round(50 + trend/2 + noise/3))),
                        five_day_ratio: Math.max(0.2, Math.round((1.2 + trend/80 + Math.random() * 0.8) * 100) / 100)
                    });
                }
                
                return data;
            }
            
            const data = generateSampleData();
            const latest = data[data.length - 1];
            
            // Determine market sentiment
            let sentiment = 'Neutral';
            let sentimentColor = '#ffa500';
            let description = 'Mixed breadth signals';
            
            if (latest.stocks_up_4pct > 300 && latest.five_day_ratio > 2.0) {
                sentiment = 'Extremely Bullish';
                sentimentColor = '#00C851';
                description = 'Strong breadth thrust in progress';
            } else if (latest.stocks_down_4pct > 300 && latest.t2108 < 20) {
                sentiment = 'Extremely Bearish';
                sentimentColor = '#ff4444';
                description = 'Potential oversold bounce opportunity';
            } else if (latest.stocks_up_4pct > latest.stocks_down_4pct + 50) {
                sentiment = 'Bullish';
                sentimentColor = '#66ff99';
                description = 'Positive breadth momentum';
            } else if (latest.stocks_down_4pct > latest.stocks_up_4pct + 50) {
                sentiment = 'Bearish';
                sentimentColor = '#ff6666';
                description = 'Negative breadth momentum';
            }
            
            document.getElementById('root').innerHTML = `
                <div class="p-6 bg-gray-50 min-h-screen">
                    <div class="max-w-7xl mx-auto">
                        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                                <div>
                                    <h1 class="text-3xl font-bold text-gray-800">Stockbee Market Monitor</h1>
                                    <p class="text-gray-600 mt-2">Breadth-based market timing tracker with interactive charts</p>
                                </div>
                                <div class="text-right mt-4 md:mt-0">
                                    <div class="text-lg font-semibold" style="color: ${sentimentColor}">${sentiment}</div>
                                    <div class="text-sm text-gray-500">${description}</div>
                                </div>
                            </div>
                            
                            <div class="w-full h-96 bg-white rounded-lg">
                                <canvas id="stockChart" width="400" height="200"></canvas>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                            <div class="bg-white rounded-lg shadow p-4">
                                <h3 class="font-semibold text-gray-800 mb-2">Key Levels</h3>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span>T2108 &lt; 20:</span>
                                        <span class="text-green-600">Oversold Signal</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>5-Day Ratio &gt; 2.0:</span>
                                        <span class="text-green-600">Breadth Thrust</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>4% Down &gt; 300:</span>
                                        <span class="text-red-600">High Selling</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>25% Down/Q &lt; 200:</span>
                                        <span class="text-green-600">Capitulation</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white rounded-lg shadow p-4">
                                <h3 class="font-semibold text-gray-800 mb-2">Current Readings</h3>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span>Stocks Up 4%+:</span>
                                        <span>${latest.stocks_up_4pct.toLocaleString()}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>Stocks Down 4%+:</span>
                                        <span>${latest.stocks_down_4pct.toLocaleString()}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>T2108:</span>
                                        <span>${latest.t2108}%</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>5-Day Ratio:</span>
                                        <span>${latest.five_day_ratio.toFixed(2)}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white rounded-lg shadow p-4">
                                <h3 class="font-semibold text-gray-800 mb-2">Interpretation</h3>
                                <div class="text-sm text-gray-600">
                                    <p class="mb-2">The Market Monitor tracks breadth using significant moves (4%+ daily, 25%+ quarterly) to reduce noise.</p>
                                    <p>Extreme readings often lead to counter-trend moves. Use for risk management and market timing.</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-4">
                            <h3 class="font-semibold text-gray-800 mb-3">Market Monitor Indicators Explained</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                <div>
                                    <h4 class="font-medium text-gray-700 mb-2">Primary Indicators:</h4>
                                    <ul class="space-y-1 text-gray-600">
                                        <li><strong>4% Up/Down:</strong> Daily count of stocks with significant moves</li>
                                        <li><strong>25% Quarter:</strong> Stocks up/down 25%+ in past 65 trading days</li>
                                        <li><strong>T2108:</strong> Percentage of stocks above 40-day moving average</li>
                                        <li><strong>5/10-Day Ratios:</strong> Ratio of up vs down 4%+ moves</li>
                                    </ul>
                                </div>
                                <div>
                                    <h4 class="font-medium text-gray-700 mb-2">Usage Guidelines:</h4>
                                    <ul class="space-y-1 text-gray-600">
                                        <li><strong>Extreme Bullish:</strong> 1000+ up moves, ratio > 2.0</li>
                                        <li><strong>Extreme Bearish:</strong> 1000+ down moves, T2108 < 20</li>
                                        <li><strong>Oversold Bounce:</strong> Quarter down < 200</li>
                                        <li><strong>Risk Management:</strong> Reduce positions on extreme readings</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Create the chart
            const ctx = document.getElementById('stockChart').getContext('2d');
            const labels = data.slice(-60).map(d => d.date);
            const stocksUpData = data.slice(-60).map(d => d.stocks_up_4pct);
            const stocksDownData = data.slice(-60).map(d => d.stocks_down_4pct);
            const t2108Data = data.slice(-60).map(d => d.t2108);
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Stocks Up 4%+',
                            data: stocksUpData,
                            borderColor: '#00C851',
                            backgroundColor: 'rgba(0, 200, 81, 0.1)',
                            tension: 0.1,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Stocks Down 4%+',
                            data: stocksDownData,
                            borderColor: '#ff4444',
                            backgroundColor: 'rgba(255, 68, 68, 0.1)',
                            tension: 0.1,
                            yAxisID: 'y'
                        },
                        {
                            label: 'T2108 (%)',
                            data: t2108Data,
                            borderColor: '#ff6600',
                            backgroundColor: 'rgba(255, 102, 0, 0.1)',
                            tension: 0.1,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    scales: {
                        x: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Date'
                            },
                            ticks: {
                                maxTicksLimit: 8
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Stock Count'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'T2108 (%)'
                            },
                            grid: {
                                drawOnChartArea: false
                            },
                            min: 0,
                            max: 100
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top'
                        },
                        title: {
                            display: true,
                            text: 'Market Breadth Indicators'
                        }
                    }
                }
            });
        }
        
        function initBasicVersion() {
            document.getElementById('root').innerHTML = `
                <div class="p-6 bg-gray-50 min-h-screen">
                    <div class="max-w-7xl mx-auto">
                        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                                <div>
                                    <h1 class="text-3xl font-bold text-gray-800">Stockbee Market Monitor</h1>
                                    <p class="text-gray-600 mt-2">Breadth-based market timing tracker</p>
                                </div>
                                <div class="text-right mt-4 md:mt-0">
                                    <div class="text-lg font-semibold text-orange-500">Loading...</div>
                                    <div class="text-sm text-gray-500">Initializing charts</div>
                                </div>
                            </div>
                            
                            <div class="chart-container">
                                <div class="text-center">
                                    <div class="text-xl font-semibold text-gray-600 mb-2">📊 Chart Loading Failed</div>
                                    <div class="text-sm text-gray-500">Please check your internet connection and try refreshing the page</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Initialize the page when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            loadCharts();
        });
        
        // Fallback - also try to load when script runs
        if (document.readyState === 'loading') {
            // Loading hasn't finished yet
            document.addEventListener('DOMContentLoaded', loadCharts);
        } else {
            // DOMContentLoaded has already fired
            loadCharts();
        }
    </script>
</body>
</html>